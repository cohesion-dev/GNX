# Historical Comments and Reviews

## Discussion Comments

**@YangSen-qn** (Oct 25, 04:34)
@xgopilot 你需要优化下动漫创建流程，动漫创建过程如下：
1. 用户上传一个小说文件以及其他所以信息，这个小说文件可能只有部分章节（后续用户还可以追加新的章节）
2. 服务收到客户的请求后，先检查这个小说是否被创建过，小说名是唯一标识，如果创建过返回错误，未创建则读取小说文件，把小说的信息插入数据库，然后开启异步任务创建动漫
3. 异步任务创建动漫：（轻量无需消息队列，内存管理一部任务即可）
        > 3.1 把文件上传到七牛云空间（这一步是同步操作），如果保存失败，则报动漫创建失败
        > 3.2 把文件按章节进行拆分，然后逐章调用生成动漫章节创建函数
        > 3.3 所有章节处理完之后，查看小说是否还有后续章节，如果没有要生成小说的icon 和背景图
4. 动漫章节创建（需要携带，小说的基本信息：简介、角色、icon 提示词、背景提示词，这些基本信息会在每次章节创建时被更新，第一章创建时这些数据为空）：经 AI 处理后最终生成本章节的动漫信息等，具体参考项目根路径下的 ai 文件夹下定义的接口,你需要对接他，不能修改他。然后更新本地数据库的章节数据，并发生成章节中运镜图片，最后更新运镜状态为完成。

追加章节需要先查询小说的基本信息，是他满足调用 动漫章节创建 所需的参数，生成之后如果没有小说的icon 和背景图则需要生成，已有则跳过；
      

---

**@xgopilot** (Oct 25, 04:34)
codeagent is processing your request, please wait a moment...

---

